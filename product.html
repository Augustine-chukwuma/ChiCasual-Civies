<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ChiCasual-Cives | Products</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
  @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;900&display=swap');
  
  :root {
    --primary: #001f3f;
    --secondary: #FF5349;
    --accent: #00ff88;
    --dark: #111;
    --light: #f8f9fa;
  }
  
  body {
    font-family: 'Poppins', sans-serif;
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    margin: 0;
    padding-bottom: 70px;
    overflow-x: hidden;
  }

  header {
    background: linear-gradient(to right, var(--primary), #003366);
    padding: 15px 20px;
    color: white;
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
    position: relative;
    z-index: 100;
    animation: headerSlideDown 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
  }

  @keyframes headerSlideDown {
    0% {
      transform: translateY(-100px);
      opacity: 0;
    }
    100% {
      transform: translateY(0);
      opacity: 1;
    }
  }

  header h1 {
    margin: 0;
    font-size: 24px;
    font-weight: 700;
    text-shadow: 0 2px 4px rgba(0,0,0,0.3);
    animation: textGlow 2s infinite alternate;
  }

  @keyframes textGlow {
    from {
      text-shadow: 0 0 5px rgba(255,255,255,0.5);
    }
    to {
      text-shadow: 0 0 15px rgba(255,255,255,0.8), 0 0 20px rgba(255,255,255,0.6);
    }
  }

  .search-bar {
    width: 50%;
    display: flex;
    position: relative;
  }

  .search-bar input {
    flex: 1;
    padding: 12px 20px;
    border: none;
    border-radius: 30px 0 0 30px;
    font-size: 14px;
    background: rgba(255,255,255,0.9);
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    transition: all 0.3s ease;
  }

  .search-bar input:focus {
    outline: none;
    box-shadow: 0 0 0 3px rgba(0,123,255,0.3);
    transform: scale(1.02);
  }

  .search-bar button {
    padding: 0 25px;
    border: none;
    background: linear-gradient(to right, var(--secondary), #ff6b6b);
    color: white;
    border-radius: 0 30px 30px 0;
    cursor: pointer;
    font-size: 16px;
    transition: all 0.3s ease;
    box-shadow: 0 4px 15px rgba(255,83,73,0.4);
  }

  .search-bar button:hover {
    background: linear-gradient(to right, #ff6b6b, var(--secondary));
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(255,83,73,0.6);
  }

  .search-bar button:active {
    transform: translateY(0);
  }

  .container {
    padding: 20px;
    animation: fadeIn 1s ease-out;
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .category {
    margin-bottom: 40px;
    animation: slideIn 0.6s ease-out forwards;
    animation-delay: calc(var(--order) * 0.1s);
    opacity: 0;
  }

  @keyframes slideIn {
    from {
      transform: translateX(-50px);
      opacity: 0;
    }
    to {
      transform: translateX(0);
      opacity: 1;
    }
  }

  .category h2 {
    color: var(--primary);
    font-size: 24px;
    margin-bottom: 15px;
    position: relative;
    display: inline-block;
  }

  .category h2::after {
    content: '';
    position: absolute;
    bottom: -5px;
    left: 0;
    width: 50px;
    height: 3px;
    background: var(--secondary);
    border-radius: 3px;
    animation: underlineGrow 0.8s ease-out forwards;
  }

  @keyframes underlineGrow {
    from {
      width: 0;
    }
    to {
      width: 50px;
    }
  }

  .product-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
    gap: 25px;
  }

  @media (min-width: 800px) {
    .product-grid {
      grid-template-columns: repeat(4, 1fr);
    }
  }

  .product {
    background-color: white;
    border-radius: 10px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    overflow: hidden;
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    position: relative;
    transform-style: preserve-3d;
    perspective: 1000px;
  }

  .product:hover {
    transform: translateY(-10px) scale(1.03);
    box-shadow: 0 15px 30px rgba(0,0,0,0.2);
  }

  .product::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(135deg, rgba(255,255,255,0.3) 0%, rgba(255,255,255,0) 100%);
    z-index: 1;
    pointer-events: none;
  }

  .product img {
    width: 100%;
    height: 200px;
    object-fit: cover;
    transition: transform 0.5s ease;
  }

  .product:hover img {
    transform: scale(1.1);
  }

  .product-details {
    padding: 15px;
    position: relative;
    z-index: 2;
    background: white;
  }

  .product-details h4 {
    margin: 0 0 10px;
    font-size: 16px;
    color: var(--dark);
    font-weight: 600;
  }

  .price {
    font-weight: bold;
    color: var(--primary);
    font-size: 16px;
    display: inline-block;
    animation: pricePulse 2s infinite;
  }

  @keyframes pricePulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.05); }
    100% { transform: scale(1); }
  }

  .discount {
    color: #999;
    text-decoration: line-through;
    font-size: 14px;
    margin-left: 8px;
  }

  .admin-link {
    position: fixed;
    bottom: 80px;
    right: 20px;
    background: linear-gradient(to right, var(--primary), #003366);
    color: white;
    padding: 12px 20px;
    border-radius: 30px;
    text-decoration: none;
    font-size: 14px;
    font-weight: bold;
    box-shadow: 0 5px 15px rgba(0,31,63,0.4);
    transition: all 0.3s ease;
    z-index: 1000;
    display: flex;
    align-items: center;
    gap: 8px;
    animation: bounce 2s infinite;
  }

  @keyframes bounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
  }

  .admin-link:hover {
    background: linear-gradient(to right, #003366, var(--primary));
    transform: translateY(-3px) scale(1.05);
    box-shadow: 0 8px 20px rgba(0,31,63,0.6);
  }

  .bottom-app-bar {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    background: linear-gradient(to right, var(--primary), #003366);
    display: flex;
    justify-content: space-around;
    align-items: center;
    padding: 12px 0;
    box-shadow: 0 -5px 15px rgba(0, 0, 0, 0.2);
    z-index: 999;
    border-top-left-radius: 20px;
    border-top-right-radius: 20px;
    animation: slideUp 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
  }

  @keyframes slideUp {
    from {
      transform: translateY(100px);
      opacity: 0;
    }
    to {
      transform: translateY(0);
      opacity: 1;
    }
  }

  .nav-item {
    text-align: center;
    color: white;
    font-size: 14px;
    text-decoration: none;
    display: flex;
    flex-direction: column;
    align-items: center;
    position: relative;
    transition: all 0.3s ease;
    padding: 5px 15px;
    border-radius: 20px;
  }

  .nav-item i {
    font-size: 22px;
    margin-bottom: 4px;
    transition: all 0.3s ease;
  }

  .nav-item:hover {
    color: var(--accent);
    transform: translateY(-5px);
    background: rgba(255,255,255,0.1);
  }

  .nav-item:hover i {
    transform: scale(1.2);
  }

  .purchase-btn {
    margin-top: 15px;
    background: linear-gradient(to right, var(--secondary), #ff6b6b);
    color: white;
    border: none;
    padding: 10px 16px;
    font-size: 14px;
    border-radius: 30px;
    cursor: pointer;
    transition: all 0.3s ease;
    width: 100%;
    font-weight: 600;
    letter-spacing: 0.5px;
    position: relative;
    overflow: hidden;
    z-index: 1;
    box-shadow: 0 4px 15px rgba(255,83,73,0.4);
  }

  .purchase-btn::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(to right, #ff6b6b, var(--secondary));
    z-index: -1;
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .purchase-btn:hover::before {
    opacity: 1;
  }

  .purchase-btn:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(255,83,73,0.6);
  }

  .purchase-btn:active {
    transform: translateY(0);
  }

  /* Crazy animations */
  @keyframes crazyLoad {
    0% {
      transform: scale(0) rotate(0deg);
      opacity: 0;
      background-color: #ff00ff;
    }
    25% {
      transform: scale(1.5) rotate(180deg);
      background-color: #00ffff;
    }
    50% {
      transform: scale(0.7) rotate(360deg);
      background-color: #ffff00;
    }
    75% {
      transform: scale(1.2) rotate(540deg);
      background-color: #ff0000;
    }
    100% {
      transform: scale(1) rotate(720deg);
      opacity: 1;
      background: linear-gradient(to right, var(--secondary), #ff6b6b);
    }
  }

  @keyframes crazyClick {
    0% { transform: scale(1); }
    25% { transform: scale(1.5) rotate(10deg); }
    50% { transform: scale(0.8) rotate(-10deg); }
    75% { transform: scale(1.3) rotate(5deg); }
    100% { transform: scale(1); }
  }

  .purchase-btn {
    animation: crazyLoad 1.5s ease-out forwards;
  }

  .purchase-btn:active {
    animation: crazyClick 0.4s ease;
  }

  .cart-badge {
    position: absolute;
    top: 0;
    right: 0;
    background-color: var(--accent);
    color: var(--dark);
    border-radius: 50%;
    font-size: 11px;
    padding: 3px 7px;
    font-weight: bold;
    line-height: 1;
    z-index: 1001;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    animation: pulse 1.5s infinite;
  }

  @keyframes pulse {
    0% {
      transform: scale(1);
      box-shadow: 0 0 0 0 rgba(0, 255, 136, 0.7);
    }
    70% {
      transform: scale(1.05);
      box-shadow: 0 0 0 10px rgba(0, 255, 136, 0);
    }
    100% {
      transform: scale(1);
      box-shadow: 0 0 0 0 rgba(0, 255, 136, 0);
    }
  }

  /* Floating particles background */
  .particles {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -1;
    pointer-events: none;
  }

  .particle {
    position: absolute;
    background: rgba(255,255,255,0.5);
    border-radius: 50%;
    animation: float linear infinite;
  }

  @keyframes float {
    to {
      transform: translateY(-100vh) rotate(360deg);
    }
  }

  /* Loading animation */
  .loading {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 200px;
    font-size: 18px;
    color: var(--primary);
  }

  .loading-spinner {
    width: 50px;
    height: 50px;
    border: 5px solid rgba(0,31,63,0.1);
    border-radius: 50%;
    border-top-color: var(--secondary);
    animation: spin 1s linear infinite;
    margin-bottom: 15px;
  }

  @keyframes spin {
    to {
      transform: rotate(360deg);
    }
  }

  /* Floating action button animation */
  .floating {
    animation: floating 3s ease-in-out infinite;
  }

  @keyframes floating {
    0% { transform: translateY(0px); }
    50% { transform: translateY(-15px); }
    100% { transform: translateY(0px); }
  }

  /* Hover tilt effect */
  .hover-tilt {
    transition: transform 0.3s ease;
  }

  .hover-tilt:hover {
    transform: rotate(2deg) scale(1.02);
  }
</style>
</head>
<body>
  <!-- Floating particles background -->
  <div class="particles" id="particles"></div>

  <header class="hover-tilt">
    <h1>ChiCasual-Cives</h1>
    <div class="search-bar">
      <input type="text" placeholder="Search products..." id="searchInput">
      <button id="searchButton"><i class="fas fa-search"></i></button>
    </div>
  </header>

  <div class="container" id="categoriesContainer">
    <!-- Categories and products will be injected here -->
  </div>

  <a href="admin.html" class="admin-link floating"><i class="fas fa-user-shield"></i> Admin Panel</a>

  <nav class="bottom-app-bar">
    <a href="product.html" class="nav-item">
      <i class="fas fa-home"></i>
      <span>Home</span>
    </a>
    <a href="#categoriesContainer" onclick="onCategoryClick()" class="nav-item">
      <i class="fas fa-th-large"></i>
      <span>Categories</span>
    </a>
    <a href="cart.html" class="nav-item" id="cartButton">
      <i class="fas fa-shopping-cart"></i>
      <span>Cart</span>
      <span class="cart-badge" id="cartBadge">0</span>
    </a>
    <a href="account.html" class="nav-item">
      <i class="fas fa-user"></i>
      <span>Account</span>
    </a>
  </nav>

  <script>
  let allProducts = [];

  // Create floating particles
  function createParticles() {
    const particlesContainer = document.getElementById('particles');
    const particleCount = window.innerWidth < 768 ? 30 : 50;
    
    for (let i = 0; i < particleCount; i++) {
      const particle = document.createElement('div');
      particle.classList.add('particle');
      
      // Random size between 2px and 6px
      const size = Math.random() * 4 + 2;
      particle.style.width = `${size}px`;
      particle.style.height = `${size}px`;
      
      // Random position
      particle.style.left = `${Math.random() * 100}vw`;
      particle.style.top = `${Math.random() * 100}vh`;
      
      // Random animation duration between 10s and 20s
      const duration = Math.random() * 10 + 10;
      particle.style.animationDuration = `${duration}s`;
      
      // Random delay
      particle.style.animationDelay = `${Math.random() * 5}s`;
      
      // Random opacity
      particle.style.opacity = Math.random() * 0.5 + 0.1;
      
      particlesContainer.appendChild(particle);
    }
  }

  async function fetchProducts() {
    try {
      // Show loading animation
      const container = document.getElementById('categoriesContainer');
      container.innerHTML = `
        <div class="loading">
          <div class="loading-spinner"></div>
          Loading products...
        </div>
      `;
      
      const res = await fetch('https://chicasual.onrender.com/api/products');
      const data = await res.json();
      allProducts = data.products || data || [];
      renderProductsByCategory(allProducts);
    } catch (err) {
      console.error('Error fetching products:', err);
      document.getElementById('categoriesContainer').innerHTML = `
        <div class="error">
          <i class="fas fa-exclamation-triangle"></i>
          <p>Failed to load products. Please try again.</p>
        </div>
      `;
    }
  }

  function renderProductsByCategory(products) {
    const container = document.getElementById('categoriesContainer');
    container.innerHTML = '';

    if (!products.length) {
      container.innerHTML = `
        <div class="empty">
          <i class="fas fa-box-open"></i>
          <p>No products available.</p>
        </div>
      `;
      return;
    }

    const categories = {};

    products.forEach(product => {
      const category = (product.category || 'Others').toLowerCase();
      if (!categories[category]) categories[category] = [];
      categories[category].push(product);
    });

    let order = 0;
    Object.keys(categories).forEach(cat => {
      const section = document.createElement('div');
      section.className = 'category';
      section.style.setProperty('--order', order++);
      section.innerHTML = `<h2>${capitalize(cat)}</h2><div class="product-grid"></div>`;

      categories[cat].forEach(product => {
        const price = parseFloat(product.price || 0);
        const discount = parseFloat(product.discount || 0);
        const discountedPrice = (price - discount).toFixed(2);
        const imageUrl = product.imageUrl || 'https://via.placeholder.com/200x200?text=No+Image';

        const card = document.createElement('div');
        card.className = 'product hover-tilt';
        card.innerHTML = `
          <div class="product-card">
            <img 
              src="${imageUrl}" 
              alt="${product.name || 'Product'}" 
              loading="lazy"
              onerror="this.src='https://via.placeholder.com/200x200?text=No+Image'" 
            />
            <div class="product-details">
              <h4>${product.name || 'Unnamed Product'}</h4>
              <div>
                <span class="price">â‚¦${discountedPrice}</span>
                ${discount ? `<span class="discount">â‚¦${price.toFixed(2)}</span>` : ''}
              </div>
              <button class="purchase-btn" onclick="purchase('${product.name}', ${discountedPrice})">
                ðŸ›’ Add To Cart
              </button>
            </div>
          </div>
        `;
        section.querySelector('.product-grid').appendChild(card);
      });

      container.appendChild(section);
    });
  }

  function capitalize(str) {
    return str.charAt(0).toUpperCase() + str.slice(1);
  }

  function filterProducts() {
    const query = document.getElementById('searchInput').value.toLowerCase();
    const filtered = allProducts.filter(p => 
      (p.name && p.name.toLowerCase().includes(query)) ||
      (p.description && p.description.toLowerCase().includes(query)) ||
      (p.category && p.category.toLowerCase().includes(query))
    );
    
    // Add search animation
    const container = document.getElementById('categoriesContainer');
    container.style.animation = 'none';
    container.offsetHeight; // Trigger reflow
    container.style.animation = 'fadeIn 0.6s ease-out';
    
    renderProductsByCategory(filtered);
    
    // Add confetti effect if results found
    if (filtered.length > 0) {
      showConfetti();
    }
  }

  function showConfetti() {
    const confettiCount = 30;
    const container = document.getElementById('categoriesContainer');
    
    for (let i = 0; i < confettiCount; i++) {
      const confetti = document.createElement('div');
      confetti.className = 'confetti';
      confetti.style.left = `${Math.random() * 100}%`;
      confetti.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, 50%)`;
      confetti.style.animation = `confettiFall ${Math.random() * 3 + 2}s linear forwards`;
      container.appendChild(confetti);
      
      // Remove confetti after animation
      setTimeout(() => {
        confetti.remove();
      }, 3000);
    }
  }

  function updateCartBadge(count) {
    const badge = document.getElementById('cartBadge');
    badge.textContent = count;
    badge.style.display = count > 0 ? 'inline-block' : 'none';
    
    // Add bounce animation when cart updates
    badge.style.animation = 'none';
    badge.offsetHeight; // Trigger reflow
    badge.style.animation = 'bounce 0.5s ease';
  }

  document.addEventListener("DOMContentLoaded", () => {
    createParticles();
    const cartCount = parseInt(localStorage.getItem("cartCount")) || 0;
    updateCartBadge(cartCount);
    fetchProducts();
    
    // Add event listeners
    document.getElementById('searchButton').addEventListener('click', filterProducts);
    document.getElementById('searchInput').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        filterProducts();
      }
    });
  });

  function onCategoryClick() {
    const selectEl = document.getElementById('categorySelect');
    if (selectEl.options.length <= 1) {
      const uniqueCategories = Array.from(
        new Set(allProducts.map(p => (p.category || 'Others').toLowerCase()))
      );
      uniqueCategories.forEach(category => {
        const option = document.createElement('option');
        option.value = category;
        option.textContent = capitalize(category);
        selectEl.appendChild(option);
      });
    }
    selectEl.style.display = selectEl.style.display === 'none' ? 'inline-block' : 'none';
  }

  function filterByCategory(category) {
    if (!category) {
      renderProductsByCategory(allProducts);
      return;
    }
    const filtered = allProducts.filter(p => (p.category || 'Others').toLowerCase() === category.toLowerCase());
    renderProductsByCategory(filtered);
  }

  async function purchase(product = 'invalid', dp = 0) {
    try {
      // Add crazy purchase animation
      const buttons = document.querySelectorAll('.purchase-btn');
      buttons.forEach(btn => {
        btn.style.animation = 'crazyClick 0.4s ease';
        setTimeout(() => {
          btn.style.animation = '';
        }, 400);
      });
      
      // Update cart
      const currentCount = parseInt(localStorage.getItem("cartCount")) || 0;
      const newCount = currentCount + 1;
      localStorage.setItem("cartCount", newCount.toString());
      updateCartBadge(newCount);
      
      // Show purchase notification
      const notification = document.createElement('div');
      notification.className = 'purchase-notification';
      notification.innerHTML = `
        <i class="fas fa-check-circle"></i>
        Added ${product} to cart!
      `;
      document.body.appendChild(notification);
      
      // Animation for notification
      setTimeout(() => {
        notification.style.opacity = '1';
        notification.style.transform = 'translate(-50%, 0)';
      }, 10);
      
      setTimeout(() => {
        notification.style.opacity = '0';
        notification.style.transform = 'translate(-50%, -100px)';
        setTimeout(() => notification.remove(), 500);
      }, 3000);
      
    } catch(err) {
      console.error('Purchase error:', err);
    }
  }

  // Add styles for dynamic elements
  const dynamicStyles = document.createElement('style');
  dynamicStyles.textContent = `
    .confetti {
      position: absolute;
      width: 10px;
      height: 10px;
      top: -10px;
      opacity: 0.8;
      z-index: 100;
    }
    
    @keyframes confettiFall {
      to {
        transform: translateY(100vh) rotate(360deg);
      }
    }
    
    .purchase-notification {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translate(-50%, -100px);
      background: rgba(0,0,0,0.8);
      color: white;
      padding: 15px 25px;
      border-radius: 30px;
      display: flex;
      align-items: center;
      gap: 10px;
      z-index: 2000;
      opacity: 0;
      transition: all 0.3s ease;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    }
    
    .purchase-notification i {
      color: var(--accent);
      font-size: 20px;
    }
    
    .error, .empty {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 200px;
      text-align: center;
    }
    
    .error i {
      color: var(--secondary);
      font-size: 40px;
      margin-bottom: 15px;
    }
    
    .empty i {
      color: #aaa;
      font-size: 40px;
      margin-bottom: 15px;
    }
  `;
  document.head.appendChild(dynamicStyles);
  </script>
</body>
</html>
